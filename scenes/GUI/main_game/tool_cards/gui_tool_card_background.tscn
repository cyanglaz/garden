[gd_scene load_steps=5 format=3 uid="uid://i1255yg1aoyk"]

[ext_resource type="Texture2D" uid="uid://ugtybr3upkmn" path="res://resources/sprites/GUI/backgrounds/tool_card_background.png" id="1_mjrml"]
[ext_resource type="Script" uid="uid://byx0ogpojvy43" path="res://scenes/GUI/main_game/tool_cards/gui_tool_card_background.gd" id="2_3efap"]

[sub_resource type="Shader" id="Shader_dn2eb"]
resource_local_to_scene = true
code = "shader_type canvas_item;

group_uniforms OUTLINE;
uniform vec4 outline_color:source_color;
uniform int outline_size = 0;

group_uniforms RESOLVE;
uniform float sensitivity : hint_range(0.0, 1.0) = .5;

varying vec4 modulate;

void vertex() {
	modulate = COLOR;
}

float random(vec2 uv) {
	return fract(sin(dot(uv, vec2(12.9898, 78.233))) * 438.5453);
}

void fragment() {
	
	vec4 base_color = COLOR;
	// Get size of texture in pixels
	float size_x = float(textureSize(TEXTURE, 0).x);
	float size_y = float(textureSize(TEXTURE, 0).y);
	
	float size_x_in_texture = 1.0/size_x;
	float size_y_in_texture = 1.0/size_y;
	vec4 sprite_color = texture(TEXTURE, UV);
	float alpha  = -4.0 * sprite_color.a;
	alpha += textureLod(TEXTURE, UV + vec2(size_x_in_texture * float(outline_size), 0), 0).a;
	alpha += textureLod(TEXTURE, UV + vec2(-size_x_in_texture * float(outline_size), 0), 0).a;
	alpha += textureLod(TEXTURE, UV + vec2(0, -size_y_in_texture * float(outline_size)), 0).a;
	alpha += textureLod(TEXTURE, UV + vec2(0, size_y_in_texture * float(outline_size)), 0).a;
	sprite_color = mix(sprite_color, outline_color, clamp(alpha, 0.0, 1.0));
	sprite_color = vec4(sprite_color.rgb, clamp(abs(alpha) + sprite_color.a, 0.0, 1.0));
	base_color = sprite_color;

	vec2 UVr = vec2(floor(UV.x*size_x)/size_x, floor(UV.y*size_y)/size_y);
	// Determine whether pixel should be visible or not
	float visible = step(sensitivity, random(UVr));
	// Draw the pixel, or not depending on if it is visible or not
	COLOR = vec4(base_color.r, base_color.g, base_color.b, min(visible, base_color.a)) * modulate;
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_ckxcp"]
resource_local_to_scene = true
shader = SubResource("Shader_dn2eb")
shader_parameter/outline_color = Color(1, 1, 1, 1)
shader_parameter/outline_size = 0
shader_parameter/sensitivity = 1.0

[node name="GUIToolCardBackground" type="NinePatchRect"]
material = SubResource("ShaderMaterial_ckxcp")
texture = ExtResource("1_mjrml")
region_rect = Rect2(0, 0, 40, 54)
patch_margin_left = 3
patch_margin_top = 3
patch_margin_right = 3
patch_margin_bottom = 3
script = ExtResource("2_3efap")
